<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Money Tracker</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav class="navbar">
    <h1>Money Tracker</h1>
  </nav>

  <section class="calendar">
    <label>
      Year:
      <input type="number" id="year" value="2025" />
    </label>
    <label>
      Month:
      <input type="number" id="month" value="7" />
    </label>
    <label>
      Day:
      <input type="number" id="day" value="22" />
    </label>
    <button onclick="loadData()">Load</button>
  </section>

  <main>
    <section class="tracker">
      <input type="text" id="income" placeholder="Enter Income" />
      <input type="text" id="expenses" placeholder="Enter Expenses" />
      <textarea id="notes" placeholder="Notes..."></textarea>
      <button onclick="saveData()">Save</button>
      <button onclick="deleteData()">Delete</button>
      <button onclick="showHistory()">Show History</button>
      <button onclick="exportData()">Export Data</button>
    </section>

    <section class="chart">
      <canvas id="moneyChart"></canvas>
    </section>

    <section class="history" id="history" style="display:none;">
      <h3>Saved Dates:</h3>
      <ul id="historyList"></ul>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    function getKey() {
      const y = document.getElementById('year').value;
      const m = document.getElementById('month').value;
      const d = document.getElementById('day').value;
      return \`\${y}-\${m.padStart?.(2,'0') || m}-\${d.padStart?.(2,'0') || d}\`;
    }

    function saveData() {
      const key = getKey();
      const data = {
        income: document.getElementById('income').value,
        expenses: document.getElementById('expenses').value,
        notes: document.getElementById('notes').value,
      };
      localStorage.setItem(key, JSON.stringify(data));
      alert("Your track today was successfully saved.");
      clearFields();
    }

    function loadData() {
      const key = getKey();
      const data = JSON.parse(localStorage.getItem(key));
      if (data) {
        document.getElementById('income').value = data.income;
        document.getElementById('expenses').value = data.expenses;
        document.getElementById('notes').value = data.notes;
      } else {
        clearFields();
      }
    }

    function deleteData() {
      const key = getKey();
      localStorage.removeItem(key);
      alert("Deleted.");
      clearFields();
    }

    function clearFields() {
      document.getElementById('income').value = '';
      document.getElementById('expenses').value = '';
      document.getElementById('notes').value = '';
    }

    function showHistory() {
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        try {
          const value = JSON.parse(localStorage.getItem(key));
          if (value && value.income !== undefined && value.expenses !== undefined) {
            const li = document.createElement('li');
            li.textContent = key;
            historyList.appendChild(li);
          }
        } catch {}
      }
      document.getElementById('history').style.display = 'block';
    }

    function exportData() {
      const allData = {};
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        try {
          const value = JSON.parse(localStorage.getItem(key));
          if (value && value.income !== undefined && value.expenses !== undefined) {
            allData[key] = value;
          }
        } catch {}
      }
      const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'money-tracker-data.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Optional: Chart.js demo
    const ctx = document.getElementById('moneyChart');
    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Income', 'Expenses'],
        datasets: [{
          data: [0, 0],
          backgroundColor: ['#4caf50', '#f44336'],
        }]
      },
      options: {
        responsive: true,
      }
    });
  </script>
</body>
</html>
